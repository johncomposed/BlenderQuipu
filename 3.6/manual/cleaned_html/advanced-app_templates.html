<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><title>Advanced &gt; App Templates</title></head>
<body><ul>
<li><a href="index.html">Advanced</a></li>
<li>Application Templates</li>
</ul><div>
<div itemprop="articleBody">
<section id="application-templates">
<h1>Application Templates</h1>
<section id="usage">
<h2>Usage</h2>
<p>Application templates are a feature that allows you to define a re-usable configuration
that can be selected to replace the default configuration,
without requiring a separate Blender installation or overwriting your personal settings.</p>
<p>Application templates can be selected from the splash screen or File ‣ New submenu.
When there are no templates found the menu will not be displayed on the splash screen.</p>
<p>New application templates can be installed from the <a href="../interface/window_system/topbar.html#topbar-blender-menu">Blender Menu</a>.
If you would like to keep the current application template active on restarting Blender, save your preferences.</p>
<section id="motivation">
<h3>Motivation</h3>
<p>In some cases it’s not enough to write a single script or add-on,
and expect someone to replace their preferences and startup file, install scripts and change their keymap.</p>
<p>The goal of application templates is to support switching to a customized configuration
without disrupting your existing settings and installation.
This means people can build their own <em>applications</em> on top of Blender that can be easily distributed.</p>
</section>
<section id="details">
<h3>Details</h3>
<p>An application template may define its own:</p>
<dl>
<dt>Startup File</dt><dd><p>The default file to load with this template.</p>
</dd>
<dt>Preferences</dt><dd><p>Only certain preferences from a template are used:</p>
<ul>
<li><p>Themes.</p></li>
<li><p>Add-ons.</p></li>
<li><p>Keymaps.</p></li>
<li><p>Viewport lighting.</p></li>
</ul>
</dd>
<dt>Splash Screen</dt><dd><p>Templates may provide their own splash screen image.</p>
</dd>
<dt>Python Scripts</dt><dd><p>While templates have access to the same functionality as any other scripts,
typical operations include:</p>
<ul>
<li><p>Modifying and replacing parts of the user interface.</p></li>
<li><p>Defining new menus, keymaps and tools.</p></li>
<li><p>Defining a custom add-on path for template specific add-ons.</p></li>
</ul>
</dd>
</dl>
<p>Templates also have their own user configuration, so saving a startup file while using a template
won’t overwrite your default startup file.</p>
</section>
<section id="directory-layout">
<h3>Directory Layout</h3>
<p>Templates may be located in one of two locations within the <code>scripts</code> directory.</p>
<dl>
<dt>Template locations:</dt><dd><div>
<div><code>{BLENDER_USER_SCRIPTS}/startup/bl_app_templates_user</code></div>
<div><code>{BLENDER_SYSTEM_SCRIPTS}/startup/bl_app_templates_system</code></div>
</div>
</dd>
</dl>
<p>User configuration is stored in a subdirectory:</p>
<dl>
<dt>Without a template:</dt><dd><div>
<div><code>./config/startup.blend</code></div>
<div><code>./config/userpref.blend</code></div>
</div>
</dd>
<dt>With a template:</dt><dd><div>
<div><code>./config/{APP_TEMPLATE_ID}/startup.blend</code></div>
<div><code>./config/{APP_TEMPLATE_ID}/userpref.blend</code></div>
</div>
</dd>
</dl>
<p>See <a href="blender_directory_layout.html#blender-directory-layout">Blender’s Directory Layout</a> for details on script and configuration locations.</p>
<div>
<p>Hint</p>
<p>Troubleshooting Paths</p>
<p>When creating an application template, you may run into issues where paths are not being found.
To investigate this you can log output of all of Blender’s path look-ups.</p>
<p>Example command line arguments that load Blender with a custom application template
(replace <code>my_app_template</code> with the name of your own template):</p>
<div><div><pre>blender --log "bke.appdir.*" --log-level -1 --app-template my_app_template
</pre></div>
</div>
<p>You can then check the paths where attempts to access <code>my_app_template</code> are made.</p>
</div>
</section>
<section id="command-line-access">
<h3>Command Line Access</h3>
<p>Using the <a href="command_line/arguments.html#command-line-args">command-line arguments</a> you can setup a launcher
that opens Blender with a specific app template:</p>
<div><div><pre>blender --app-template my_template
</pre></div>
</div>
</section>
</section>
<section id="template-contents">
<h2>Template Contents</h2>
<p>Each of the following files can be used for application templates but are optional.</p>
<dl>
<dt><code>startup.blend</code></dt><dd><p>Factory startup file to use for this template.</p>
</dd>
<dt><code>userpref.blend</code></dt><dd><p>Factory preferences file to use for this template.
When omitted preferences are shared with the default Blender configuration.</p>
<p><em>(As noted previously, this is only used for a subset of preferences).</em></p>
</dd>
<dt><code>splash.png</code></dt><dd><p>Splash screen to override Blender’s default artwork (not including header text).
Note, this image must be a <code>1000x500</code> image.</p>
</dd>
<dt><code>__init__.py</code></dt><dd><p>A Python script which must contain <code>register</code> and <code>unregister</code> functions.</p>
</dd>
</dl>
<div>
<p>Note</p>
<p>Bundled blend-files <code>startup.blend</code> and <code>userpref.blend</code> are considered <em>Factory Settings</em>
and are never overwritten.</p>
<p>The user may save their own startup/preferences while using this template which will be stored
in their user configuration, but only when the template includes its own <code>userpref.blend</code> file.</p>
<p>The original template settings can be loaded using: <em>Load Template Factory Settings</em>
from the file menu in much the same way <em>Load Factory Settings</em> works.</p>
</div>
</section>
<section id="template-scripts">
<h2>Template Scripts</h2>
<p>While app templates can use Python scripts,
they simply have access to the same APIs available for add-ons and any other scripts.</p>
<p>As noted above, you may optionally have an <code>__init__.py</code> in your app template.
This has the following advantages:</p>
<ul>
<li><p>Changes can be made to the startup or preferences, without having to distribute a blend-file.</p></li>
<li><p>Changes can be made dynamically.</p>
<p>You could for example – configure the template to check the number of processors,
operating system and memory, then set values based on this.</p>
</li>
<li><p>You may enable add-ons associated with your template.</p></li>
</ul>
<p>On activation a <code>register</code> function is called, <code>unregister</code> is called when another template is selected.</p>
<p>As these only run once, any changes to defaults must be made via handler.
Two handlers you are likely to use are:</p>
<ul>
<li><p><code>bpy.app.handlers.load_factory_preferences_post</code></p></li>
<li><p><code>bpy.app.handlers.load_factory_startup_post</code></p></li>
</ul>
<p>These allow you to define your own “factory settings”, which the user may change,
just as Blender has it’s own defaults when first launched.</p>
<p>This is an example <code>__init__.py</code> file which defines defaults for an app template to use.</p>
<div><div><pre>import bpy
from bpy.app.handlers import persistent

@persistent
def load_handler_for_preferences(_):
    print("Changing Preference Defaults!")
    from bpy import context

    prefs = context.preferences
    prefs.use_preferences_save = False

    kc = context.window_manager.keyconfigs["blender"]
    kc_prefs = kc.preferences
    if kc_prefs is not None:
        kc_prefs.select_mouse = 'RIGHT'
        kc_prefs.spacebar_action = 'SEARCH'
        kc_prefs.use_pie_click_drag = True

    view = prefs.view
    view.header_align = 'BOTTOM'


@persistent
def load_handler_for_startup(_):
    print("Changing Startup Defaults!")

    # Use smooth faces.
    for mesh in bpy.data.meshes:
        for poly in mesh.polygons:
            poly.use_smooth = True

    # Use material preview shading.
    for screen in bpy.data.screens:
        for area in screen.areas:
            for space in area.spaces:
                if space.type == 'VIEW_3D':
                    space.shading.type = 'MATERIAL'
                    space.shading.use_scene_lights = True


def register():
    print("Registering to Change Defaults")
    bpy.app.handlers.load_factory_preferences_post.append(load_handler_for_preferences)
    bpy.app.handlers.load_factory_startup_post.append(load_handler_for_startup)

def unregister():
    print("Unregistering to Change Defaults")
    bpy.app.handlers.load_factory_preferences_post.remove(load_handler_for_preferences)
    bpy.app.handlers.load_factory_startup_post.remove(load_handler_for_startup)
</pre></div>
</div>
</section>
</section>
</div>
</div></body>
</html>