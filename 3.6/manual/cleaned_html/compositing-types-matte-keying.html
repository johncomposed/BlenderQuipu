<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><title>Compositing &gt; Types &gt; Matte &gt; Keying</title></head>
<body><ul>
<li><a href="../../index.html">Compositing</a></li>
<li><a href="index.html">Matte Nodes</a></li>
<li>Keying Node</li>
</ul><div>
<div itemprop="articleBody">
<section id="keying-node">
<h1>Keying Node</h1>
<p>CPU Compositor Only</p>
<p>The <em>Keying</em> node is a one-stop-shop for “green screen” / “blue screen” removal.
It performs both chroma keying to remove the backdrop and despill to correct color cast from the backdrop.
Additionally, you can perform common operations used to tweak the resulting matte.</p>
<section id="inputs">
<h2>Inputs</h2>
<dl>
<dt>Image</dt><dd><p>Standard color input.</p>
</dd>
<dt>Key Color</dt><dd><p>The color of content to be removed. This may be a single color,
or a reference image such as generated by
the <a href="keying_screen.html">Keying Screen Node</a>.</p>
</dd>
<dt>Garbage Matte</dt><dd><p>An optional mask of area(s) to always <em>exclude</em> from the output.
This is removed from the chroma key generated matte.</p>
</dd>
<dt>Core Matte</dt><dd><p>An optional mask of area(s) to always <em>include</em> in the output.
This is merged with the chroma key generated matte.</p>
</dd>
</dl>
</section>
<section id="properties">
<h2>Properties</h2>
<dl>
<dt>Pre Blur</dt><dd><p>Reduce the effects of color noise in the image by blurring only color by the given amount,
leaving luminosity intact. This will affect matte calculation only, not the result image.</p>
</dd>
<dt>Screen Balance</dt><dd><p>This is the balance between color channels compared with the key color.
0.5 will average the other channels (red and blue in the case of a green screen).</p>
<p>This may be tweaked in tandem with <em>Clip Black</em> and <em>Clip White</em> while
checking the <em>Matte</em> output to create a mask with optimal separation.</p>
</dd>
<dt>Despill Factor</dt><dd><p>Controls how much color bleed from the key color is removed from the input
image: 0 means no despilling, 1 means all possible spilling will be removed.
The underlying implementation is the same as adjusting the <em>Unspill</em> amount
of the <a href="color_spill.html">Color Spill Node</a>.</p>
</dd>
<dt>Despill Balance</dt><dd><p>This controls how the color channels are compared when computing spill,
affecting the hue and shade of the corrected colors.
It is similar to setting the <em>Limiting Channel</em>
in the <a href="color_spill.html">Color Spill Node</a>.</p>
</dd>
<dt>Edge Kernel Radius</dt><dd><p>Defines the radius in pixel used to detect an edge.</p>
</dd>
<dt>Edge Kernel Tolerance</dt><dd><p>Defines threshold used to check if pixels in radius are the same as current pixel:
if the difference between pixel colors is higher than this threshold then the point
will be considered an edge.</p>
</dd>
<dt>Clip Black</dt><dd><p>This sets the threshold for what becomes fully transparent in the output (black in the matte).
It should be set as low as possible. Uneven backdrops will require this value to be increased.
Use of the <a href="keying_screen.html">Keying Screen Node</a> can help
keep this value low. You may also use a <em>Garbage Matte</em> to exclude problematic areas.</p>
<p>This value does not impact areas detected as edges to ensure edge detail is preserved.</p>
</dd>
<dt>Clip White</dt><dd><p>This sets the threshold for what becomes fully opaque in the output (white in the matte).
It should be set as high as possible. Colors close to green in the foreground
may require reducing this value and/or adjusting the <em>Screen Balance</em>.
Particularly problematic parts can fixed with a <em>Core Matte</em> instead of a low <em>Clip White</em>.</p>
<p>This value does not impact areas detected as edges to ensure edge detail is preserved.</p>
</dd>
<dt>Dilate/Erode</dt><dd><p>Enlarge (positive numbers) or shrink (negative numbers) the matte by the specified number of pixels.
This is similar to using the <a href="../filter/dilate_erode.html">Dilate/Erode Node</a> on the matte.</p>
<p>This a simple way to include more or less along the edges of the matte, particularly combined with <em>Post Blur</em>.</p>
</dd>
<dt>Feather Falloff</dt><dd><p>The rate of the falloff at the edges of the matte when feathering, to manage edge detail.</p>
</dd>
<dt>Feather Distance</dt><dd><p>Controls how much the matte is feathered inwards (negative number) or outwards (positive number).</p>
</dd>
<dt>Post Blur</dt><dd><p>Make the matte less sharp, for smoother transitions to the background and noise reduction.</p>
</dd>
</dl>
</section>
<section id="outputs">
<h2>Outputs</h2>
<dl>
<dt>Image</dt><dd><p>Processed image with the <em>Matte</em> applied to the images’ <a href="../../../glossary/index.html#term-Alpha-Channel">Alpha Channel</a>.</p>
</dd>
<dt>Matte</dt><dd><p>Output matte to use for checking the quality of the key, or to manually apply
using a <a href="../converter/set_alpha.html">Set Alpha Node</a> or
<a href="../color/mix.html">Mix Node</a>.</p>
</dd>
<dt>Edges</dt><dd><p>Shows what edges were detected on the matte.
Useful for adjusting the <em>Edge Kernel Radius</em> and <em>Edge Kernel Tolerance</em>.</p>
</dd>
</dl>
<div>
<p>Tip</p>
<p>If there are problems with the edges of the matte, it may help to start with
adjusting the <em>Edge Kernel</em> parameters before adjusting feathering.
Detected edges are not subject to <em>Clip Black</em> / <em>Clip White</em> thresholds
to preserve fine edge detail. You can check edge detection by connecting
a <a href="../output/viewer.html">Viewer Node</a> to the <em>Edges</em> output.</p>
<p>Sharper detected edges (smaller <em>Edge Kernel Radius</em>, like 2 / larger <em>Edge Kernel Tolerance</em>, like 0.4)
will create a sharper matte, but may loose some detail like stray hairs.
A sharp matte is good, but disappearing or flickering hairs are distracting.</p>
<p>Fat edges (larger <em>Edge Kernel Radius</em>, like 8 / smaller <em>Edge Kernel Tolerance</em>, like 0.05)
will capture more edge detail, but may also produce a halo around the subject.
The halo can be adjusted with <em>Feather</em> controls along with <em>Dilate/Erode</em>.</p>
</div>
</section>
</section>
</div>
</div></body>
</html>